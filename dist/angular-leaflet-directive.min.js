/*! angular-leaflet-directive 08-05-2013 */
var leafletDirective=angular.module("leaflet-directive",[]);leafletDirective.directive("leaflet",function(e,t){return{restrict:"E",replace:!0,transclude:!0,scope:{center:"=center",tilelayer:"=tilelayer",markers:"=markers",path:"=path",maxZoom:"=maxzoom",bounds:"=bounds"},template:'<div class="angular-leaflet-map"></div>',link:function(e,n,a){var o=n[0],r=new L.Map(o),c=12;e.maxZoom&&(c=e.maxZoom);var i=new L.LatLng(0,0);r.setView(i,1),r.locate({setView:!0,maxZoom:c});var l=e.tilelayer||"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";if(L.tileLayer(l,{maxZoom:c}).addTo(r),a.center){e.$watch("center",function(t){if(void 0!==t){t=new L.LatLng(e.center.lat,e.center.lng);var n=e.center.zoom||8;r.setView(t,n)}}),e.bounds=r.getBounds();var g=!1;r.on("dragstart",function(){g=!0}),r.on("drag",function(){e.$apply(function(e){e.center.lat=r.getCenter().lat,e.center.lng=r.getCenter().lng})}),r.on("dragend",function(){g=!1}),r.on("moveend",function(){e.$apply(function(e){e.bounds=r.getBounds()})}),e.$watch("center.lng",function(e){g||r.setView(new L.LatLng(r.getCenter().lat,e),r.getZoom())}),e.$watch("center.lat",function(e){g||r.setView(new L.LatLng(e,r.getCenter().lng),r.getZoom())});var s=!1;r.on("zoomstart",function(){s=!0}),e.$watch("center.zoom",function(t){s||e.$$phase||r.setZoom(t)}),r.on("zoomend",function(){void 0!==e.center&&void 0!==e.center.zoom&&(e.$$phase||(e.$apply(function(e){e.center.zoom=r.getZoom(),e.bounds=r.getBounds()}),s=!1))})}if(void 0!==a.markers){var m=[],u=function(e,t){var n=t.markers[e],a=new L.marker(t.markers[e],{draggable:n.draggable?!0:!1});if(n.message&&(t.$watch("markers."+e+".message",function(){a.bindPopup(n.message)}),t.$watch("markers."+e+".focus",function(e){e&&a.openPopup()})),n.draggable){var o=!1;a.on("dragstart",function(){o=!0}),a.on("drag",function(){t.$apply(function(){n.lat=a.getLatLng().lat,n.lng=a.getLatLng().lng})}),a.on("dragend",function(){o=!1,n.message&&a.openPopup()}),t.$watch("markers."+e,function(){a.setLatLng(t.markers[e])},!0),t.$watch("markers"+e+".lng",function(e){!o&&e&&a.setLatLng(new L.LatLng(a.getLatLng().lat,e))}),t.$watch("markers"+e+".lat",function(e){!o&&e&&a.setLatLng(new L.LatLng(e,a.getLatLng().lng))})}return a};e.$watch("markers",function(){for(var t in m)e.markers[t]||(r.removeLayer(m[t]),delete m[t]);for(var n in e.markers)if(void 0===m[n]){var a=u(n,e);r.addLayer(a),m[n]=a}},!0)}if(a.path){var d=new L.Polyline([],{});r.addLayer(d),e.$watch("path",function(n){for(var a=n.latlngs,o=0,r=a.length;r>o;o++)(void 0===a[o]||void 0===a[o].lat||void 0===a[o].lng)&&(t.warn("Bad path point inn the $scope.path array "),a.splice(o,1));d.setLatLngs(a),d.setStyle({smoothFactor:e.path.smoothFactor,color:e.path.color})},!0)}}}});