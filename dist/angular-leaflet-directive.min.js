/*! angular-leaflet-directive 03-06-2013 */
var leafletDirective=angular.module("leaflet-directive",[]);leafletDirective.directive("leaflet",["$http","$log",function(a,b){var c={maxZoom:14,tileLayer:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",icon:{url:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-icon.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-icon@2x.png",size:[25,41],anchor:[12,40],popup:[0,-40],shadow:{url:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-shadow.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-shadow.png",size:[41,41],anchor:[12,40]}},path:{weight:10,opacity:1}};return{restrict:"E",replace:!0,transclude:!0,scope:{center:"=center",maxBounds:"=maxbounds",markers:"=markers",defaults:"=defaults",path:"=path"},template:'<div class="angular-leaflet-map"></div>',link:function(a,d,e){function f(){a.maxBounds&&a.maxBounds&&a.maxBounds.southWest&&a.maxBounds.southWest.lat&&a.maxBounds.southWest.lng&&a.maxBounds.northEast&&a.maxBounds.northEast.lat&&a.maxBounds.northEast.lng&&(m.setMaxBounds(new L.LatLngBounds(new L.LatLng(a.maxBounds.southWest.lat,a.maxBounds.southWest.lng),new L.LatLng(a.maxBounds.northEast.lat,a.maxBounds.northEast.lng))),a.$watch("maxBounds",function(a){a.southWest&&a.northEast&&a.southWest.lat&&a.southWest.lng&&a.northEast.lat&&a.northEast.lng&&m.setMaxBounds(new L.LatLngBounds(new L.LatLng(a.southWest.lat,a.southWest.lng),new L.LatLng(a.northEast.lat,a.northEast.lng)))}))}function g(){a.center&&(a.center.lat&&a.center.lng&&a.center.zoom?m.setView([a.center.lat,a.center.lng],a.center.zoom):a.center.autoDiscover===!0&&m.locate({setView:!0,maxZoom:a.leaflet.maxZoom}),m.on("dragend",function(){a.$apply(function(a){a.center.lat=m.getCenter().lat,a.center.lng=m.getCenter().lng})}),m.on("zoomend",function(){a.center.zoom!==m.getZoom()&&a.$apply(function(a){a.center.zoom=m.getZoom()})}),a.$watch("center",function(a){a.lat&&a.lng&&a.zoom&&m.setView([a.lat,a.lng],a.zoom)},!0))}function h(){var b={};if(a.leaflet.markers=e.testing?b:'Add testing="testing" to <leaflet> tag to inspect this object',a.markers){for(var c in a.markers)b[c]=i(c,a.markers[c],m);a.$watch("markers",function(a){for(var c in a)void 0===b[c]&&(b[c]=i(c,a[c],m));for(var d in b)void 0===a[d]&&delete b[d]},!0)}}function i(b,c,d){var e=j(b,c);return d.addLayer(e),c.focus===!0&&e.openPopup(),e.on("dragend",function(){a.$apply(function(){c.lat=e.getLatLng().lat,c.lng=e.getLatLng().lng}),c.message&&e.openPopup()}),a.$watch("markers."+b,function(a,b){return a?(b&&(void 0!==a.draggable&&a.draggable!==b.draggable&&(a.draggable===!0?e.dragging.enable():e.dragging.disable()),void 0!==a.focus&&a.focus!==b.focus&&(a.focus===!0?e.openPopup():e.closePopup()),void 0!==a.message&&a.message!==b.message&&e.bindPopup(a),(a.lat!==b.lat||a.lng!==b.lng)&&e.setLatLng(new L.LatLng(a.lat,a.lng))),void 0):(d.removeLayer(e),void 0)},!0),e}function j(b,c){var d=new L.marker(a.markers[b],{icon:k(),draggable:c.draggable?!0:!1});return c.message&&d.bindPopup(c.message),d}function k(){return L.icon({iconUrl:c.icon.url,iconRetinaUrl:c.icon.retinaUrl,iconSize:c.icon.size,iconAnchor:c.icon.anchor,popupAnchor:c.icon.popup,shadowUrl:c.icon.shadow.url,shadowRetinaUrl:c.icon.shadow.retinaUrl,shadowSize:c.icon.shadow.size,shadowAnchor:c.icon.shadow.anchor})}function l(){if(a.path){b.warn("[AngularJS - Leaflet] Creating polylines and adding them to the map will break the directive's scope's inspection in AngularJS Batarang");var d=new L.Polyline([],{weight:c.path.weight,opacity:c.path.opacity});a.leaflet.path=e.testing?d:'Add testing="testing" to <leaflet> tag to inspect this object',m.addLayer(d),a.$watch("path.latlngs",function(a){var b=a.filter(function(a){return!!a.lat&&!!a.lng}).map(function(a){return new L.LatLng(a.lat,a.lng)});d.setLatLngs(b)},!0),a.$watch("path.weight",function(a){d.setStyle({weight:a})},!0),a.$watch("path.color",function(a){d.setStyle({color:a})},!0)}}var m=new L.Map(d[0]);m.setView([0,0],1),a.leaflet={},a.leaflet.map=e.testing?m:'Add testing="testing" to <leaflet> tag to inspect this object',a.leaflet.maxZoom=e.defaults&&a.defaults&&a.defaults.maxZoom?parseInt(a.defaults.maxZoom,10):c.maxZoom,a.leaflet.tileLayer=e.defaults&&a.defaults&&a.defaults.tileLayer?a.defaults.tileLayer:c.tileLayer,L.tileLayer(a.leaflet.tileLayer,{maxZoom:a.leaflet.maxZoom}).addTo(m),g(),f(),h(),l()}}}]);