/*! angular-leaflet-directive 22-08-2013 */
var leafletDirective=angular.module("leaflet-directive",[]);leafletDirective.directive("leaflet",["$http","$log","$parse","$rootScope",function(a,b,c,d){var e={maxZoom:14,minZoom:1,doubleClickZoom:!0,scrollWheelZoom:!0,tileLayer:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},icon:{url:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-icon.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-icon@2x.png",size:[25,41],anchor:[12,40],popup:[0,-40],shadow:{url:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-shadow.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-shadow.png",size:[41,41],anchor:[12,40]}},path:{weight:10,opacity:1,color:"#0000ff"}},f=L.Icon.extend({options:{iconUrl:e.icon.url,iconRetinaUrl:e.icon.retinaUrl,iconSize:e.icon.size,iconAnchor:e.icon.anchor,popupAnchor:e.icon.popup,shadowUrl:e.icon.shadow.url,shadowRetinaUrl:e.icon.shadow.retinaUrl,shadowSize:e.icon.shadow.size,shadowAnchor:e.icon.shadow.anchor}}),g='Add testing="testing" to <leaflet> tag to inspect this object';return{restrict:"E",replace:!0,transclude:!0,scope:{center:"=center",maxBounds:"=maxbounds",bounds:"=bounds",marker:"=marker",markers:"=markers",legend:"=legend",geojson:"=geojson",defaults:"=defaults",paths:"=paths",tiles:"=tiles",events:"=events"},template:'<div class="angular-leaflet-map"></div>',link:function(a,h,i){function j(){var b=a.$root.$$phase;return!("$apply"===b||"$digest"===b)}function k(b){j()?a.$apply(b):a.$eval(b)}function l(){function a(a){return function(b){var c="leafletDirectiveMap."+a;k(function(){d.$broadcast(c,{leafletEvent:b})})}}for(var b=["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","contextmenu","focus","blur","preclick","load","unload","viewreset","movestart","move","moveend","dragstart","drag","dragend","zoomstart","zoomend","zoomlevelschange","resize","autopanstart","layeradd","layerremove","baselayerchange","overlayadd","overlayremove","locationfound","locationerror","popupopen","popupclose"],c=0;c<b.length;c++){var e=b[c];C.on(e,a(e),{eventName:e})}}function m(){if("object"!=typeof a.events)return!1;for(var b in a.events)C.on(b,a.events[b])}function n(){var b,c;if(a.leaflet.tileLayer=i.defaults&&a.defaults&&a.defaults.tileLayer?a.defaults.tileLayer:e.tileLayer,a.defaults&&a.defaults.tileLayerOptions)for(c in a.defaults.tileLayerOptions)e.tileLayerOptions[c]=a.defaults.tileLayerOptions[c];if(i.tiles){if(a.tiles&&a.tiles.url&&(a.leaflet.tileLayer=a.tiles.url),a.tiles&&a.tiles.options)for(c in a.tiles.options)e.tileLayerOptions[c]=a.tiles.options[c];a.$watch("tiles.url",function(a){a&&b.setUrl(a)})}b=L.tileLayer(a.leaflet.tileLayer,e.tileLayerOptions),b.addTo(C),a.leaflet.tileLayerObj=i.testing?b:g}function o(){if(a.legend)if(a.legend.colors&&a.legend.labels&&a.legend.colors.length===a.legend.labels.length){var c=a.legend.position||"bottomright",d=L.control({position:c});d.onAdd=function(){for(var b=L.DomUtil.create("div","info legend"),c=0;c<a.legend.colors.length;c++)b.innerHTML+='<i style="background:'+a.legend.colors[c]+'"></i> '+a.legend.labels[c]+"<br />";return b},d.addTo(C)}else b.warn("[AngularJS - Leaflet] legend.colors and legend.labels must be set.")}function p(){a.maxBounds&&a.maxBounds.southWest&&a.maxBounds.southWest.lat&&a.maxBounds.southWest.lng&&a.maxBounds.northEast&&a.maxBounds.northEast.lat&&a.maxBounds.northEast.lng&&(C.setMaxBounds(new L.LatLngBounds(new L.LatLng(a.maxBounds.southWest.lat,a.maxBounds.southWest.lng),new L.LatLng(a.maxBounds.northEast.lat,a.maxBounds.northEast.lng))),a.$watch("maxBounds",function(a){a.southWest&&a.northEast&&a.southWest.lat&&a.southWest.lng&&a.northEast.lat&&a.northEast.lng&&C.setMaxBounds(new L.LatLngBounds(new L.LatLng(a.southWest.lat,a.southWest.lng),new L.LatLng(a.northEast.lat,a.northEast.lng)))}))}function q(a){if(a){var b=a.southWest,c=a.northEast;if(b&&c&&b.lat&&b.lng&&c.lat&&c.lng){var d=new L.LatLng(b.lat,b.lng),e=new L.LatLng(c.lat,c.lng);C.fitBounds(new L.LatLngBounds(d,e))}}}function r(){a.bounds&&a.$watch("bounds",function(a){q(a)})}function s(){if(!i.center)return b.warn("[AngularJS - Leaflet] 'center' is undefined in the current scope, did you forget to initialize it?"),C.setView([0,0],1),void 0;var d={lat:c("center.lat"),lng:c("center.lng"),zoom:c("center.zoom")};a.$watch("center",function(b){b&&(void 0!==b.lat&&void 0!==b.lng&&void 0!==b.zoom?C.setView([b.lat,b.lng],b.zoom):b.autoDiscover===!0&&C.locate({setView:!0,maxZoom:a.leaflet.maxZoom}))},!0),C.on("moveend",function(){k(function(a){d&&(d.lat.assign(a,C.getCenter().lat),d.lng.assign(a,C.getCenter().lng),d.zoom.assign(a,C.getZoom()))})})}function t(){a.$watch("geojson",function(b){b&&(a.leaflet.geojson&&C.removeLayer(a.leaflet.geojson),b.hasOwnProperty("data")&&(a.leaflet.geojson=L.geoJson(a.geojson.data,{style:a.geojson.style,onEachFeature:function(a,c){c.on({mouseover:function(c){k(function(){b.selected=a}),b.mouseover&&b.mouseover(c)},mouseout:function(a){k(function(){b.selected=void 0}),b.mouseout&&b.mouseout(a)},click:function(a){b.click&&b.click(b.selected,a)}})}}).addTo(C)))})}function u(){var b;a.marker&&(b=w("marker",a.marker,C),a.leaflet.marker=i.testing?b:g,b.on("click",function(){k(function(){d.$broadcast("leafletDirectiveMainMarkerClick")})}))}function v(){var b={};if(a.leaflet.markers=i.testing?b:g,a.markers){for(var c in a.markers)b[c]=w("markers."+c,a.markers[c],C);a.$watch("markers",function(a){for(var c in b)void 0===a[c]&&delete b[c];for(var d in a)void 0===b[d]&&(b[d]=w("markers."+d,a[d],C))},!0)}}function w(c,e,g){function h(a){return function(b){var f="leafletDirectiveMarker."+a,g=c.replace("markers.","");"click"===a?k(function(){d.$broadcast("leafletDirectiveMarkersClick",g)}):"dragend"===a&&(k(function(){e.lat=i.getLatLng().lat,e.lng=i.getLatLng().lng}),e.message&&e.focus===!0&&i.openPopup()),k(function(){d.$broadcast(f,{markerName:g,leafletEvent:b})})}}var i=x(e);g.addLayer(i),e.focus===!0&&i.openPopup();for(var j=["click","dblclick","mousedown","mouseover","mouseout","contextmenu","dragstart","drag","dragend","move","remove","popupopen","popupclose"],l=0;l<j.length;l++){var m=j[l];i.on(m,h(m),{eventName:m,scope_watch_name:c})}var n=a.$watch(c,function(a,c){if(!a)return g.removeLayer(i),n(),void 0;if(c){if(void 0===a.draggable||null===a.draggable||a.draggable!==!0?void 0!==c.draggable&&null!==c.draggable&&c.draggable===!0&&i.dragging.disable():(void 0===c.draggable||null===c.draggable||c.draggable!==!0)&&i.dragging.enable(),void 0===a.message||null===a.message||"string"!=typeof a.message||""===a.message?void 0!==c.message&&null!==c.message&&"string"==typeof c.message&&""!==c.message&&(i.closePopup(),i.unbindPopup()):void 0===c.message||null===c.message||"string"!=typeof c.message||""===c.message?(i.bindPopup(a.message),a.focus===!0&&i.openPopup()):a.message!==c.message&&i.setPopupContent(a.message),void 0===a.focus||null===a.focus||a.focus!==!0?void 0!==c.focus&&null!==c.focus&&c.focus===!0&&i.closePopup():(void 0===c.focus||null===c.focus||c.focus!==!0)&&i.openPopup(),void 0===a.lat||null===a.lat||isNaN(a.lat)||"number"!=typeof a.lat||void 0===a.lng||null===a.lng||isNaN(a.lng)||"number"!=typeof a.lng)b.warn("There are problems with lat-lng data, please verify your marker model");else{var d=i.getLatLng();(d.lat!==a.lat||d.lng!==a.lng)&&i.setLatLng([a.lat,a.lng])}void 0===a.icon||null===a.icon||"object"!=typeof a.icon?void 0!==c.icon&&null!==c.icon&&"object"==typeof c.icon&&i.setIcon(new f):void 0===c.icon||null===c.icon||"object"!=typeof c.icon?i.setIcon(new f(a.icon)):JSON.stringify(a.icon)!==JSON.stringify(c.icon)&&i.setIcon(new f(a.icon))}},!0);return i}function x(a){var b=null;b=a.icon?a.icon:new f;var c=new L.marker(a,{icon:b,draggable:a.draggable?!0:!1});return a.message&&c.bindPopup(a.message),c}function y(){var c={};if(a.leaflet.paths=i.testing?c:g,a.paths){b.warn("[AngularJS - Leaflet] Creating polylines and adding them to the map will break the directive's scope's inspection in AngularJS Batarang");for(var d in a.paths)c[d]=z(d,a.paths[d],C);a.$watch("paths",function(a){for(var b in a)void 0===c[b]&&(c[b]=z(b,a[b],C));for(var d in c)void 0===a[d]&&delete c[d]},!0)}}function z(b,c,d){var f=new L.Polyline([],{weight:e.path.weight,color:e.path.color,opacity:e.path.opacity});if(void 0!==c.latlngs){var g=A(c.latlngs);f.setLatLngs(g)}void 0!==c.weight&&f.setStyle({weight:c.weight}),void 0!==c.color&&f.setStyle({color:c.color}),void 0!==c.opacity&&f.setStyle({opacity:c.opacity}),d.addLayer(f);var h=a.$watch("paths."+b,function(a,b){if(!a)return d.removeLayer(f),h(),void 0;if(b){if(void 0!==a.latlngs&&a.latlngs!==b.latlngs){var c=A(a.latlngs);f.setLatLngs(c)}void 0!==a.weight&&a.weight!==b.weight&&f.setStyle({weight:a.weight}),void 0!==a.color&&a.color!==b.color&&f.setStyle({color:a.color}),void 0!==a.opacity&&a.opacity!==b.opacity&&f.setStyle({opacity:a.opacity})}},!0);return f}function A(a){var b=a.filter(function(a){return!!a.lat&&!!a.lng}).map(function(a){return new L.LatLng(a.lat,a.lng)});return b}function B(){a.defaults&&a.defaults.zoomControlPosition&&C.zoomControl.setPosition(a.defaults.zoomControlPosition)}i.width&&h.css("width",i.width),i.height&&h.css("height",i.height),a.leaflet={},a.leaflet.maxZoom=i.defaults&&a.defaults&&a.defaults.maxZoom?parseInt(a.defaults.maxZoom,10):e.maxZoom,a.leaflet.minZoom=i.defaults&&a.defaults&&a.defaults.minZoom?parseInt(a.defaults.minZoom,10):e.minZoom,a.leaflet.doubleClickZoom=i.defaults&&a.defaults&&"boolean"==typeof a.defaults.doubleClickZoom?a.defaults.doubleClickZoom:e.doubleClickZoom,a.leaflet.scrollWheelZoom=i.defaults&&a.defaults&&"boolean"==typeof a.defaults.scrollWheelZoom?a.defaults.scrollWheelZoom:e.scrollWheelZoom;var C=new L.Map(h[0],{maxZoom:a.leaflet.maxZoom,minZoom:a.leaflet.minZoom,doubleClickZoom:a.leaflet.doubleClickZoom,scrollWheelZoom:a.leaflet.scrollWheelZoom});C.setView([0,0],10),a.leaflet.map=i.testing?C:g,B(),n(),s(),p(),r(),u(),v(),y(),o(),l(),m(),t(),a.$on("leafletDirectiveSetMap",function(a,b){var c=b.shift();C[c].apply(C,b)})}}}]);