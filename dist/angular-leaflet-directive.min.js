/*! angular-leaflet-directive 08-06-2013 */
var leafletDirective=angular.module("leaflet-directive",[]);leafletDirective.directive("leaflet",["$http","$log",function(t,e){var a={maxZoom:14,tileLayer:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",icon:{url:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-icon.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-icon@2x.png",size:[25,41],anchor:[12,40],popup:[0,-40],shadow:{url:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-shadow.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-shadow.png",size:[41,41],anchor:[12,40]}},path:{weight:10,opacity:1}};return{restrict:"E",replace:!0,transclude:!0,scope:{center:"=center",maxBounds:"=maxbounds",markers:"=markers",defaults:"=defaults",path:"=path"},template:'<div class="angular-leaflet-map"></div>',link:function(t,n,o){function l(){t.maxBounds&&t.maxBounds&&t.maxBounds.southWest&&t.maxBounds.southWest.lat&&t.maxBounds.southWest.lng&&t.maxBounds.northEast&&t.maxBounds.northEast.lat&&t.maxBounds.northEast.lng&&(d.setMaxBounds(new L.LatLngBounds(new L.LatLng(t.maxBounds.southWest.lat,t.maxBounds.southWest.lng),new L.LatLng(t.maxBounds.northEast.lat,t.maxBounds.northEast.lng))),t.$watch("maxBounds",function(t){t.southWest&&t.northEast&&t.southWest.lat&&t.southWest.lng&&t.northEast.lat&&t.northEast.lng&&d.setMaxBounds(new L.LatLngBounds(new L.LatLng(t.southWest.lat,t.southWest.lng),new L.LatLng(t.northEast.lat,t.northEast.lng)))}))}function s(){t.$watch("center",function(e){e&&(e.lat&&e.lng&&e.zoom?d.setView([e.lat,e.lng],e.zoom):e.autoDiscover===!0&&d.locate({setView:!0,maxZoom:t.leaflet.maxZoom}))},!0),d.on("dragend",function(){t.$apply(function(t){t.center.lat=d.getCenter().lat,t.center.lng=d.getCenter().lng})}),d.on("zoomend",function(){t.center.zoom!==d.getZoom()&&t.$apply(function(t){t.center.zoom=d.getZoom(),t.center.lat=d.getCenter().lat,t.center.lng=d.getCenter().lng})})}function r(){var e={};if(t.leaflet.markers=o.testing?e:'Add testing="testing" to <leaflet> tag to inspect this object',t.markers){for(var a in t.markers)e[a]=i(a,t.markers[a],d);t.$watch("markers",function(t){for(var a in t)void 0===e[a]&&(e[a]=i(a,t[a],d));for(var n in e)void 0===t[n]&&delete e[n]},!0)}}function i(e,a,n){var o=c(e,a);return n.addLayer(o),a.focus===!0&&o.openPopup(),o.on("dragend",function(){t.$apply(function(){a.lat=o.getLatLng().lat,a.lng=o.getLatLng().lng}),a.message&&o.openPopup()}),t.$watch("markers."+e,function(t,e){return t?(e&&(void 0!==t.draggable&&t.draggable!==e.draggable&&(t.draggable===!0?o.dragging.enable():o.dragging.disable()),void 0!==t.focus&&t.focus!==e.focus&&(t.focus===!0?o.openPopup():o.closePopup()),void 0!==t.message&&t.message!==e.message&&o.bindPopup(t),(t.lat!==e.lat||t.lng!==e.lng)&&o.setLatLng(new L.LatLng(t.lat,t.lng))),void 0):(n.removeLayer(o),void 0)},!0),o}function c(e,a){var n=new L.marker(t.markers[e],{icon:g(),draggable:a.draggable?!0:!1});return a.message&&n.bindPopup(a.message),n}function g(){return L.icon({iconUrl:a.icon.url,iconRetinaUrl:a.icon.retinaUrl,iconSize:a.icon.size,iconAnchor:a.icon.anchor,popupAnchor:a.icon.popup,shadowUrl:a.icon.shadow.url,shadowRetinaUrl:a.icon.shadow.retinaUrl,shadowSize:a.icon.shadow.size,shadowAnchor:a.icon.shadow.anchor})}function u(){if(t.path){e.warn("[AngularJS - Leaflet] Creating polylines and adding them to the map will break the directive's scope's inspection in AngularJS Batarang");var n=new L.Polyline([],{weight:a.path.weight,opacity:a.path.opacity});t.leaflet.path=o.testing?n:'Add testing="testing" to <leaflet> tag to inspect this object',d.addLayer(n),t.$watch("path.latlngs",function(t){var e=t.filter(function(t){return!!t.lat&&!!t.lng}).map(function(t){return new L.LatLng(t.lat,t.lng)});n.setLatLngs(e)},!0),t.$watch("path.weight",function(t){n.setStyle({weight:t})},!0),t.$watch("path.color",function(t){n.setStyle({color:t})},!0)}}var d=new L.Map(n[0]);d.setView([0,0],1),t.leaflet={},t.leaflet.map=o.testing?d:'Add testing="testing" to <leaflet> tag to inspect this object',t.leaflet.maxZoom=o.defaults&&t.defaults&&t.defaults.maxZoom?parseInt(t.defaults.maxZoom,10):a.maxZoom,t.leaflet.tileLayer=o.defaults&&t.defaults&&t.defaults.tileLayer?t.defaults.tileLayer:a.tileLayer,L.tileLayer(t.leaflet.tileLayer,{maxZoom:t.leaflet.maxZoom}).addTo(d),s(),l(),r(),u()}}}]);