/*! angular-leaflet-directive 16-05-2013 */
var leafletDirective=angular.module("leaflet-directive",[]);leafletDirective.directive("leaflet",["$http","$log",function(e,t){return{restrict:"E",replace:!0,transclude:!0,scope:{center:"=center",tilelayer:"=tilelayer",markers:"=markers",path:"=path",maxZoom:"@maxzoom"},template:'<div class="angular-leaflet-map"></div>',link:function(e,a,n){var r=a[0],o=new L.Map(r);n.testing&&(e.map=o),n.maxzoom&&(e.maxZoom=parseInt(n.maxzoom,10)),o.setView([0,0],1);var l=e.tilelayer||"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",i=e.maxZoom||12;if(L.tileLayer(l,{maxZoom:i}).addTo(o),n.center&&e.center&&(e.center.lat&&e.center.lng&&e.center.zoom?o.setView([e.center.lat,e.center.lng],e.center.zoom):e.center.autoDiscover===!0&&o.locate({setView:!0,maxZoom:i}),o.on("dragend",function(){e.$apply(function(e){e.center.lat=o.getCenter().lat,e.center.lng=o.getCenter().lng})}),o.on("zoomend",function(){e.center.zoom!==o.getZoom()&&e.$apply(function(e){e.center.zoom=o.getZoom()})}),e.$watch("center",function(e){e.lat&&e.lng&&e.zoom&&o.setView([e.lat,e.lng],e.zoom)},!0)),n.markers&&e.markers){var g=function(e,t){var a=t.markers[e],r=new L.marker(t.markers[e],{draggable:a.draggable?!0:!1});return a.message&&r.bindPopup(a.message),r.on("dragend",function(){t.$apply(function(){a.lat=r.getLatLng().lat,a.lng=r.getLatLng().lng,a.message&&r.openPopup()})}),t.$watch("markers."+e,function(a,l){return a?(void 0!==a.draggable&&a.draggable!==l.draggable&&(a.draggable===!0?r.dragging.enable():r.dragging.disable()),void 0!==a.focus&&a.focus!==l.focus&&(a.focus===!0?r.openPopup():r.closePopup()),void 0!==a.message&&a.message!==l.message&&r.bindPopup(a),(a.lat!==l.lat||a.lng!==l.lng)&&r.setLatLng(new L.LatLng(a.lat,a.lng)),void 0):(o.removeLayer(markers[e]),delete s[e],n.testing&&delete t.leafletMarkers[e],void 0)},!0),r},s={};n.testing&&(e.leafletMarkers={});for(var c in e.markers){var m=g(c,e);o.addLayer(m),s[c]=m,n.testing&&(e.leafletMarkers[c]=m)}e.$watch("markers",function(t){for(var a in t)if(void 0===s[a]){var r=g(a,e);o.addLayer(r),s[a]=r,n.testing&&(e.leafletMarkers[a]=r)}},!0)}if(n.path&&e.path){var p=new L.Polyline([],{weight:10,opacity:1});n.testing&&(e.polyline=p),o.addLayer(p),e.$watch("path.latlngs",function(e){for(var a=0,n=e.length;n>a;a++)(void 0===e[a]||void 0===e[a].lat||void 0===e[a].lng)&&(t.warn("Bad path point inn the $scope.path array "),e.splice(a,1));p.setLatLngs(e)},!0),e.$watch("path.weight",function(e){p.setStyle({weight:e})},!0),e.$watch("path.color",function(e){p.setStyle({color:e})},!0)}}}}]);