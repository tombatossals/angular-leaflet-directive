/*! angular-leaflet-directive 15-05-2013 */
var leafletDirective=angular.module("leaflet-directive",[]);leafletDirective.directive("leaflet",["$http","$log",function(e,a){return{restrict:"E",replace:!0,transclude:!0,scope:{center:"=center",tilelayer:"=tilelayer",markers:"=markers",path:"=path",maxZoom:"@maxzoom"},template:'<div class="angular-leaflet-map"></div>',link:function(e,t,n){var r=t[0],o=new L.Map(r);n.map&&(e.map=o),n.maxzoom&&(e.maxZoom=parseInt(n.maxzoom,10)),o.setView([0,0],1);var l=e.tilelayer||"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",i=e.maxZoom||12;if(L.tileLayer(l,{maxZoom:i}).addTo(o),n.center&&e.center&&(e.center.lat&&e.center.lng&&e.center.zoom?o.setView(new L.LatLng(e.center.lat,e.center.lng),e.center.zoom):e.center.autoDiscover===!0&&o.locate({setView:!0,maxZoom:i}),o.on("dragend",function(){e.$apply(function(e){e.center.lat=o.getCenter().lat,e.center.lng=o.getCenter().lng})}),o.on("zoomend",function(){e.$apply(function(e){e.center.zoom=o.getZoom()})}),e.$watch("center",function(e){o.setView([e.lat,e.lng],e.zoom)},!0)),n.markers&&e.markers){var c={},g=function(e,a){var t=a.markers[e],n=new L.marker(a.markers[e],{draggable:t.draggable?!0:!1});return n.on("dragend",function(){a.$apply(function(){t.lat=n.getLatLng().lat,t.lng=n.getLatLng().lng,t.message&&n.openPopup()})}),a.$watch("markers."+e,function(a,t){return a?(void 0!==a.draggable&&a.draggable!==t.draggable&&(a.draggable===!0?n.dragging.enable():n.dragging.disable()),void 0!==a.focus&&a.focus!==t.focus&&(a.focus===!0?n.openPopup():n.closePopup()),void 0!==a.message&&a.message!==t.message&&n.bindPopup(a),(a.lat!==t.lat||a.lng!==t.lng)&&n.setLatLng(new L.LatLng(a.lat,a.lng)),void 0):(o.removeLayer(c[e]),delete c[e],void 0)},!0),n};e.$watch("markers",function(){for(var a in e.markers)if(void 0===c[a]){var t=g(a,e);o.addLayer(t),c[a]=t}},!0)}if(n.path){var s=new L.Polyline([],{weight:10,opacity:1});o.addLayer(s),e.$watch("path.latlngs",function(e){for(var t=0,n=e.length;n>t;t++)(void 0===e[t]||void 0===e[t].lat||void 0===e[t].lng)&&(a.warn("Bad path point inn the $scope.path array "),e.splice(t,1));s.setLatLngs(e)},!0),e.$watch("path.weight",function(e){s.setStyle({weight:e})},!0),e.$watch("path.color",function(e){s.setStyle({color:e})},!0)}}}}]);